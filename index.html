<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Puzzle&Guardians í€˜ìŠ¤íŠ¸ ëŒ€ì‹œë³´ë“œ</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .stat-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 1rem;
            padding: 1.5rem;
            color: white;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            transition: transform 0.2s;
        }
        .stat-card:hover {
            transform: translateY(-5px);
        }
        .quest-card {
            background: white;
            border-radius: 0.75rem;
            padding: 1.25rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
            border-left: 4px solid #667eea;
            transition: all 0.2s;
        }
        .quest-card:hover {
            box-shadow: 0 4px 16px rgba(0,0,0,0.12);
            transform: translateX(5px);
        }
        .quest-active {
            border-left-color: #10b981;
            background: linear-gradient(to right, #ecfdf5 0%, white 100%);
        }
        .quest-ended {
            border-left-color: #ef4444;
            background: linear-gradient(to right, #fef2f2 0%, white 100%);
        }
        .quest-upcoming {
            border-left-color: #f59e0b;
            background: linear-gradient(to right, #fffbeb 0%, white 100%);
        }
        .loading {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #667eea;
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        .status-badge {
            display: inline-block;
            padding: 0.25rem 0.75rem;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
        }
        .progress-bar {
            height: 8px;
            background: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
        }
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.5s ease;
        }
    </style>
</head>
<body class="bg-gray-50">
    <div class="container mx-auto px-4 py-8 max-w-7xl">
        <!-- í—¤ë” -->
        <div class="mb-8">
            <div class="flex items-center justify-between mb-4">
                <div>
                    <h1 class="text-4xl font-bold text-gray-800 mb-2">ğŸ® Puzzle&Guardians</h1>
                    <p class="text-gray-600">í€˜ìŠ¤íŠ¸ ë³´ìƒ í´ë ˆì„ í˜„í™© ëŒ€ì‹œë³´ë“œ</p>
                </div>
                <div class="flex gap-2">
                    <button onclick="clearCache()" class="px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors font-semibold">
                        ğŸ—‘ï¸ ìºì‹œ ì‚­ì œ
                    </button>
                    <button onclick="refreshData()" class="px-6 py-3 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors font-semibold shadow-lg">
                        ğŸ”„ ìƒˆë¡œê³ ì¹¨
                    </button>
                </div>
            </div>
            <div class="bg-white p-4 rounded-lg shadow-sm border border-gray-200">
                <div class="flex items-center justify-between">
                    <div>
                        <p class="text-sm text-gray-600 mb-1">ë³´ìƒ ì§€ê°‘ ì£¼ì†Œ</p>
                        <p class="font-mono text-sm break-all text-purple-600 font-semibold">0x3156f02e943cefb0247283b7f89b4ebf91133cff</p>
                    </div>
                    <div class="text-right">
                        <p class="text-xs text-gray-500">ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸</p>
                        <p class="text-sm font-semibold text-gray-700" id="lastUpdate">-</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- ì „ì²´ í†µê³„ -->
        <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-8">
            <div class="stat-card">
                <p class="text-sm opacity-90 mb-1">ğŸ’° ì§€ê°‘ ì”ì•¡</p>
                <p class="text-3xl font-bold" id="totalBalance">ë¡œë”©ì¤‘...</p>
                <p class="text-xs opacity-75 mt-1">BORA</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);">
                <p class="text-sm opacity-90 mb-1">âœ… ì´ í´ë ˆì„</p>
                <p class="text-3xl font-bold" id="totalClaims">0</p>
                <p class="text-xs opacity-75 mt-1">ê±´</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);">
                <p class="text-sm opacity-90 mb-1">ğŸ‘¥ ì°¸ì—¬ ìœ ì €</p>
                <p class="text-3xl font-bold" id="uniqueUsers">0</p>
                <p class="text-xs opacity-75 mt-1">ëª…</p>
            </div>
            <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%);">
                <p class="text-sm opacity-90 mb-1">ğŸ’¸ ì´ ì§€ê¸‰ì•¡</p>
                <p class="text-3xl font-bold" id="totalPaid">0</p>
                <p class="text-xs opacity-75 mt-1">BORA</p>
            </div>
        </div>

        <!-- ì°¨íŠ¸ ì„¹ì…˜ -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8">
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ“Š ì¼ë³„ í´ë ˆì„ ì¶”ì´</h2>
                <canvas id="dailyClaimsChart"></canvas>
            </div>
            <div class="bg-white p-6 rounded-lg shadow-lg">
                <h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ¯ í€˜ìŠ¤íŠ¸ë³„ ë¶„í¬</h2>
                <canvas id="questDistributionChart"></canvas>
            </div>
        </div>

        <!-- í€˜ìŠ¤íŠ¸ë³„ ìƒì„¸ í˜„í™© -->
        <div class="bg-white p-6 rounded-lg shadow-lg mb-8">
            <div class="flex items-center justify-between mb-6">
                <h2 class="text-xl font-bold text-gray-800">ğŸ“‹ í€˜ìŠ¤íŠ¸ë³„ ìƒì„¸ í˜„í™©</h2>
                <div class="flex gap-2">
                    <select id="questFilter" class="px-4 py-2 border border-gray-300 rounded-lg text-sm focus:ring-2 focus:ring-purple-500 focus:border-transparent">
                        <option value="default">ê¸°ë³¸ ìˆœì„œ</option>
                        <option value="id-asc">í€˜ìŠ¤íŠ¸ ë²ˆí˜¸ìˆœ (ì˜¤ë¦„ì°¨ìˆœ)</option>
                        <option value="id-desc">í€˜ìŠ¤íŠ¸ ë²ˆí˜¸ìˆœ (ë‚´ë¦¼ì°¨ìˆœ)</option>
                        <option value="start-asc">ì‹œì‘ì¼ìˆœ (ë¹ ë¥¸ìˆœ)</option>
                        <option value="start-desc">ì‹œì‘ì¼ìˆœ (ëŠ¦ì€ìˆœ)</option>
                        <option value="reward-asc">ë³´ìƒ ê·œëª¨ìˆœ (ì‘ì€ìˆœ)</option>
                        <option value="reward-desc">ë³´ìƒ ê·œëª¨ìˆœ (í°ìˆœ)</option>
                        <option value="claims-desc">í´ë ˆì„ ë§ì€ìˆœ</option>
                        <option value="claims-asc">í´ë ˆì„ ì ì€ìˆœ</option>
                        <option value="status-active">ì§„í–‰ì¤‘ë§Œ ë³´ê¸°</option>
                        <option value="status-ended">ì¢…ë£Œëœ ê²ƒë§Œ ë³´ê¸°</option>
                    </select>
                </div>
            </div>
            <div id="questList" class="space-y-4">
                <div class="text-center py-12">
                    <div class="loading mx-auto"></div>
                    <p class="mt-4 text-gray-600">ë°ì´í„° ë¶„ì„ì¤‘...</p>
                </div>
            </div>
        </div>

        <!-- ìµœê·¼ í´ë ˆì„ ë‚´ì—­ -->
        <div class="bg-white p-6 rounded-lg shadow-lg">
            <h2 class="text-xl font-bold mb-4 text-gray-800">ğŸ•’ ìµœê·¼ í´ë ˆì„ ë‚´ì—­</h2>
            <div class="overflow-x-auto">
                <table class="w-full">
                    <thead>
                        <tr class="border-b-2 border-gray-200 bg-gray-50">
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">ì‹œê°„</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">í€˜ìŠ¤íŠ¸</th>
                            <th class="text-left py-3 px-4 text-sm font-semibold text-gray-700">ìˆ˜ì‹ ì</th>
                            <th class="text-right py-3 px-4 text-sm font-semibold text-gray-700">ë³´ìƒì•¡</th>
                            <th class="text-center py-3 px-4 text-sm font-semibold text-gray-700">íŠ¸ëœì­ì…˜</th>
                        </tr>
                    </thead>
                    <tbody id="transactionList">
                        <tr>
                            <td colspan="5" class="text-center py-8">
                                <div class="loading mx-auto"></div>
                                <p class="mt-4 text-gray-600">íŠ¸ëœì­ì…˜ ë¡œë”©ì¤‘...</p>
                            </td>
                        </tr>
                    </tbody>
                </table>
            </div>
            <div class="mt-4 flex justify-between items-center">
                <button id="prevPage" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 disabled:bg-gray-300 disabled:cursor-not-allowed transition-colors" disabled>â† ì´ì „</button>
                <span class="text-gray-600 font-semibold">í˜ì´ì§€ <span id="currentPage">1</span></span>
                <button id="nextPage" class="px-4 py-2 bg-purple-600 text-white rounded-lg hover:bg-purple-700 transition-colors">ë‹¤ìŒ â†’</button>
            </div>
        </div>
    </div>

    <script>
        const WALLET_ADDRESS = '0x3156f02e943cefb0247283b7f89b4ebf91133cff';
        const BORA_TOKEN_ADDRESS = '0x02cbe46fb8a1f579254a9b485788f2d86cad51aa';
        const CACHE_KEY = 'puzzle_guardians_cache';
        const CACHE_DURATION = 5 * 60 * 1000; // 5ë¶„
        
        // Vercel API URL
        const API_URL = 'https://puzzle-guardians-backend.vercel.app/api/transactions';
        
        // í€˜ìŠ¤íŠ¸ ì •ì˜
        const QUESTS = [
            {
                id: 1,
                name: 'ê°€ë””ì–¸ 20ê°œ ìˆ˜ì§‘',
                description: 'ê°€ì… 7ì¼ ì´ë‚´',
                startDate: new Date('2025-10-29'),
                endDate: new Date('2025-11-28'),
                reward: 20,
                token: 'BORA'
            },
            {
                id: 2,
                name: '4ì„± ê°€ë””ì–¸ 3ê°œ ìˆ˜ì§‘',
                description: 'ê°€ì… 7ì¼ ì´ë‚´',
                startDate: new Date('2025-10-29'),
                endDate: new Date('2025-11-28'),
                reward: 40,
                token: 'BORA'
            },
            {
                id: 3,
                name: '50 BOCA íšë“',
                description: 'ê²Œì„ ë‚´ í™”í íšë“',
                startDate: new Date('2025-10-30'),
                endDate: new Date('2025-11-27'),
                reward: 50,
                token: 'BORA'
            },
            {
                id: 4,
                name: '75 BOCA íšë“',
                description: 'ê²Œì„ ë‚´ í™”í íšë“',
                startDate: new Date('2025-10-30'),
                endDate: new Date('2025-11-27'),
                reward: 100,
                token: 'BORA'
            },
            {
                id: 5,
                name: '150 BOCA íšë“',
                description: 'ê²Œì„ ë‚´ í™”í íšë“',
                startDate: new Date('2025-10-30'),
                endDate: new Date('2025-11-27'),
                reward: 270,
                token: 'BORA'
            },
            {
                id: 6,
                name: '300 BOCA íšë“',
                description: 'ê²Œì„ ë‚´ í™”í íšë“',
                startDate: new Date('2025-10-30'),
                endDate: new Date('2025-11-27'),
                reward: 600,
                token: 'BORA'
            },
            {
                id: 10,
                name: 'ë ˆë²¨3+ìŠ¤íƒ€í„°íŒ© êµ¬ë§¤',
                description: 'ì¸ì•± ê²°ì œ',
                startDate: new Date('2026-01-14'),
                endDate: new Date('2026-12-31'),
                reward: 10,
                token: 'BORA'
            },
            // ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨
            {id: 101, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 1ë“±', description: 'ë­í‚¹ 1ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 4350, token: 'BORA', category: 'event'},
            {id: 102, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 2ë“±', description: 'ë­í‚¹ 2ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 2910, token: 'BORA', category: 'event'},
            {id: 103, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 3ë“±', description: 'ë­í‚¹ 3ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 1950, token: 'BORA', category: 'event'},
            {id: 104, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 4~5ìœ„', description: 'ë­í‚¹ 4~5ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 1310, token: 'BORA', category: 'event'},
            {id: 105, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 6~10ìœ„', description: 'ë­í‚¹ 6~10ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 880, token: 'BORA', category: 'event'},
            {id: 106, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 11~20ìœ„', description: 'ë­í‚¹ 11~20ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 590, token: 'BORA', category: 'event'},
            {id: 107, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 21~30ìœ„', description: 'ë­í‚¹ 21~30ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 390, token: 'BORA', category: 'event'},
            {id: 108, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 31~50ìœ„', description: 'ë­í‚¹ 31~50ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 260, token: 'BORA', category: 'event'},
            {id: 109, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 51~70ìœ„', description: 'ë­í‚¹ 51~70ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 180, token: 'BORA', category: 'event'},
            {id: 110, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 71~100ìœ„', description: 'ë­í‚¹ 71~100ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 120, token: 'BORA', category: 'event'},
            {id: 111, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 101~150ìœ„', description: 'ë­í‚¹ 101~150ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 80, token: 'BORA', category: 'event'},
            {id: 112, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 150~200ìœ„', description: 'ë­í‚¹ 150~200ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 50, token: 'BORA', category: 'event'},
            {id: 113, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 201~300ìœ„', description: 'ë­í‚¹ 201~300ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 40, token: 'BORA', category: 'event'},
            {id: 114, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 301~500ìœ„', description: 'ë­í‚¹ 301~500ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 30, token: 'BORA', category: 'event'},
            {id: 115, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 501~750ìœ„', description: 'ë­í‚¹ 501~750ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 20, token: 'BORA', category: 'event'},
            {id: 116, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 1íšŒì°¨ - 751~1000ìœ„', description: 'ë­í‚¹ 751~1000ìœ„', startDate: new Date('2025-11-19'), endDate: new Date('2025-11-29'), reward: 10, token: 'BORA', category: 'event'},
            // ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨
            {id: 201, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨ - 1ë“±', description: 'ë­í‚¹ 1ìœ„', startDate: new Date('2025-12-06'), endDate: new Date('2025-12-13'), reward: 1960, token: 'BORA', category: 'event'},
            {id: 202, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨ - 2ë“±', description: 'ë­í‚¹ 2ìœ„', startDate: new Date('2025-12-06'), endDate: new Date('2025-12-13'), reward: 1360, token: 'BORA', category: 'event'},
            {id: 203, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨ - 3ë“±', description: 'ë­í‚¹ 3ìœ„', startDate: new Date('2025-12-06'), endDate: new Date('2025-12-13'), reward: 940, token: 'BORA', category: 'event'},
            {id: 204, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨ - 4~5ìœ„', description: 'ë­í‚¹ 4~5ìœ„', startDate: new Date('2025-12-06'), endDate: new Date('2025-12-13'), reward: 650, token: 'BORA', category: 'event'},
            {id: 205, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨ - 6~10ìœ„', description: 'ë­í‚¹ 6~10ìœ„', startDate: new Date('2025-12-06'), endDate: new Date('2025-12-13'), reward: 450, token: 'BORA', category: 'event'},
            {id: 206, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨ - 11~20ìœ„', description: 'ë­í‚¹ 11~20ìœ„', startDate: new Date('2025-12-06'), endDate: new Date('2025-12-13'), reward: 310, token: 'BORA', category: 'event'},
            {id: 207, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨ - 21~30ìœ„', description: 'ë­í‚¹ 21~30ìœ„', startDate: new Date('2025-12-06'), endDate: new Date('2025-12-13'), reward: 210, token: 'BORA', category: 'event'},
            {id: 208, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨ - 31~50ìœ„', description: 'ë­í‚¹ 31~50ìœ„', startDate: new Date('2025-12-06'), endDate: new Date('2025-12-13'), reward: 150, token: 'BORA', category: 'event'},
            {id: 209, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨ - 51~70ìœ„', description: 'ë­í‚¹ 51~70ìœ„', startDate: new Date('2025-12-06'), endDate: new Date('2025-12-13'), reward: 100, token: 'BORA', category: 'event'},
            {id: 210, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 2íšŒì°¨ - 71~100ìœ„', description: 'ë­í‚¹ 71~100ìœ„', startDate: new Date('2025-12-06'), endDate: new Date('2025-12-13'), reward: 70, token: 'BORA', category: 'event'},
            // ì´ë²¤íŠ¸ ë¦¬ê·¸ 3íšŒì°¨
            {id: 301, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 3íšŒì°¨ - 1ë“±', description: 'ë­í‚¹ 1ìœ„', startDate: new Date('2025-12-27'), endDate: new Date('2026-01-02'), reward: 10460, token: 'BORA', category: 'event'},
            {id: 302, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 3íšŒì°¨ - 2ë“±', description: 'ë­í‚¹ 2ìœ„', startDate: new Date('2025-12-27'), endDate: new Date('2026-01-02'), reward: 4810, token: 'BORA', category: 'event'},
            {id: 303, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 3íšŒì°¨ - 3ë“±', description: 'ë­í‚¹ 3ìœ„', startDate: new Date('2025-12-27'), endDate: new Date('2026-01-02'), reward: 2210, token: 'BORA', category: 'event'},
            {id: 304, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 3íšŒì°¨ - 4~5ìœ„', description: 'ë­í‚¹ 4~5ìœ„', startDate: new Date('2025-12-27'), endDate: new Date('2026-01-02'), reward: 1020, token: 'BORA', category: 'event'},
            {id: 305, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 3íšŒì°¨ - 6~10ìœ„', description: 'ë­í‚¹ 6~10ìœ„', startDate: new Date('2025-12-27'), endDate: new Date('2026-01-02'), reward: 470, token: 'BORA', category: 'event'},
            {id: 306, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 3íšŒì°¨ - 11~20ìœ„', description: 'ë­í‚¹ 11~20ìœ„', startDate: new Date('2025-12-27'), endDate: new Date('2026-01-02'), reward: 220, token: 'BORA', category: 'event'},
            {id: 307, name: 'ì´ë²¤íŠ¸ ë¦¬ê·¸ 3íšŒì°¨ - 21~30ìœ„', description: 'ë­í‚¹ 21~30ìœ„', startDate: new Date('2025-12-27'), endDate: new Date('2026-01-02'), reward: 100, token: 'BORA', category: 'event'}
        ];

        let currentPage = 1;
        let allTransactions = [];
        let questStatsData = {};
        let dailyClaimsChart, questDistributionChart;

        // ì„œë²„ APIì—ì„œ íŠ¸ëœì­ì…˜ ì¡°íšŒ
        async function fetchTokenTransfersFromAPI() {
            try {
                console.log('ğŸ” ì„œë²„ APIë¡œ íŠ¸ëœì­ì…˜ ì¡°íšŒ ì¤‘...');
                console.log('  API URL:', API_URL);
                
                const response = await fetch(API_URL);
                
                if (!response.ok) {
                    throw new Error(`ì„œë²„ ì˜¤ë¥˜: ${response.status}`);
                }
                
                const data = await response.json();
                
                console.log('ğŸ“¦ API ì‘ë‹µ:', data);
                
                if (!data.success) {
                    throw new Error(data.error || 'API ì˜¤ë¥˜');
                }
                
                console.log(`âœ… ${data.count}ê°œ íŠ¸ëœì­ì…˜ ë¡œë“œ ì™„ë£Œ`);
                console.log(`ğŸ’¾ ìºì‹œ ì‚¬ìš©: ${data.cached ? 'Yes' : 'No'}`);
                
                return data.transactions;
                
            } catch (error) {
                console.error('âŒ API ì¡°íšŒ ì‹¤íŒ¨:', error);
                console.log('\nâš ï¸ API URLì„ í™•ì¸í•˜ì„¸ìš”!');
                console.log('í˜„ì¬ ì„¤ì •:', API_URL);
                console.log('Vercel ë°°í¬ í›„ ì‹¤ì œ URLë¡œ ë³€ê²½ í•„ìš”');
                return [];
            }
        }

        // ìºì‹œì—ì„œ ë°ì´í„° ë¡œë“œ
        function loadFromCache() {
            try {
                const cached = localStorage.getItem(CACHE_KEY);
                if (!cached) return null;
                
                const data = JSON.parse(cached);
                const now = Date.now();
                
                // ìºì‹œê°€ ë§Œë£Œë˜ì—ˆëŠ”ì§€ í™•ì¸
                if (now - data.timestamp > CACHE_DURATION) {
                    console.log('â° ìºì‹œ ë§Œë£Œë¨');
                    return null;
                }
                
                console.log('âœ… ìºì‹œì—ì„œ ë°ì´í„° ë¡œë“œ:', data.transactions.length, 'ê±´');
                return data;
            } catch (error) {
                console.error('ìºì‹œ ë¡œë“œ ì‹¤íŒ¨:', error);
                return null;
            }
        }

        // ìºì‹œì— ë°ì´í„° ì €ì¥
        function saveToCache(transactions) {
            try {
                const data = {
                    timestamp: Date.now(),
                    transactions: transactions
                };
                localStorage.setItem(CACHE_KEY, JSON.stringify(data));
                console.log('ğŸ’¾ ìºì‹œì— ì €ì¥ë¨');
            } catch (error) {
                console.error('ìºì‹œ ì €ì¥ ì‹¤íŒ¨:', error);
            }
        }

        // ìºì‹œ ì‚­ì œ
        function clearCache() {
            localStorage.removeItem(CACHE_KEY);
            alert('ìºì‹œê°€ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤. í˜ì´ì§€ë¥¼ ìƒˆë¡œê³ ì¹¨í•©ë‹ˆë‹¤.');
            location.reload();
        }

        // í€˜ìŠ¤íŠ¸ ì‹ë³„
        function identifyQuest(tx) {
            const amount = Math.round(tx.amount);
            const txDate = new Date(tx.timestamp);
            
            for (let quest of QUESTS) {
                if (amount === quest.reward && 
                    txDate >= quest.startDate && 
                    txDate <= quest.endDate) {
                    return quest;
                }
            }
            return null;
        }

        // í€˜ìŠ¤íŠ¸ ìƒíƒœ í™•ì¸
        function getQuestStatus(quest) {
            const now = new Date();
            if (now < quest.startDate) return 'upcoming';
            if (now > quest.endDate) return 'ended';
            return 'active';
        }

        // ë°ì´í„° ì´ˆê¸°í™”
        async function initializeData() {
            try {
                // ìºì‹œ í™•ì¸
                const cached = loadFromCache();
                
                if (cached) {
                    console.log('ğŸš€ ìºì‹œ ë°ì´í„° ì‚¬ìš©');
                    allTransactions = cached.transactions;
                    updateLastUpdate(new Date(cached.timestamp));
                } else {
                    console.log('ğŸŒ APIì—ì„œ ìƒˆ ë°ì´í„° ë¡œë“œ');
                    const transactions = await fetchTokenTransfersFromAPI();
                    
                    if (transactions.length === 0) {
                        alert('íŠ¸ëœì­ì…˜ ë°ì´í„°ë¥¼ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ì—†ìŠµë‹ˆë‹¤. ë‚˜ì¤‘ì— ë‹¤ì‹œ ì‹œë„í•´ì£¼ì„¸ìš”.');
                        return;
                    }
                    
                    allTransactions = transactions;
                    saveToCache(transactions);
                    updateLastUpdate(new Date());
                }
                
                // í€˜ìŠ¤íŠ¸ ì‹ë³„
                allTransactions = allTransactions.map(tx => ({
                    ...tx,
                    quest: identifyQuest(tx)
                })).sort((a, b) => b.timestamp - a.timestamp);

                // BORA ì”ì•¡ ê³„ì‚°
                const totalPaid = allTransactions.reduce((sum, tx) => sum + tx.amount, 0);
                const INITIAL_BALANCE = 191909; // ì´ˆê¸° ì”ì•¡ (ìˆ˜ë™ ì„¤ì • í•„ìš”)
                const currentBalance = INITIAL_BALANCE - totalPaid;
                document.getElementById('totalBalance').textContent = currentBalance.toLocaleString(undefined, {maximumFractionDigits: 2});
                
                // í†µê³„ ì—…ë°ì´íŠ¸
                document.getElementById('totalClaims').textContent = allTransactions.length.toLocaleString();
                
                const uniqueUsers = new Set(allTransactions.map(tx => tx.to)).size;
                document.getElementById('uniqueUsers').textContent = uniqueUsers.toLocaleString();
                
                document.getElementById('totalPaid').textContent = totalPaid.toLocaleString(undefined, {maximumFractionDigits: 2});

                // í€˜ìŠ¤íŠ¸ë³„ ìƒì„¸ í˜„í™©
                updateQuestList();
                
                // ì°¨íŠ¸ ìƒì„±
                createCharts();
                
                // íŠ¸ëœì­ì…˜ ëª©ë¡ í‘œì‹œ
                displayTransactions();

            } catch (error) {
                console.error('ë°ì´í„° ì´ˆê¸°í™” ì‹¤íŒ¨:', error);
                alert('ë°ì´í„° ë¡œë”© ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            }
        }

        // ë§ˆì§€ë§‰ ì—…ë°ì´íŠ¸ ì‹œê°„ í‘œì‹œ
        function updateLastUpdate(date) {
            document.getElementById('lastUpdate').textContent = date.toLocaleString('ko-KR');
        }

        // í€˜ìŠ¤íŠ¸ ëª©ë¡ ì—…ë°ì´íŠ¸
        function updateQuestList() {
            const questStats = {};
            
            QUESTS.forEach(quest => {
                questStats[quest.id] = {
                    quest: quest,
                    claims: 0,
                    users: new Set(),
                    totalPaid: 0
                };
            });
            
            allTransactions.forEach(tx => {
                if (tx.quest) {
                    const stats = questStats[tx.quest.id];
                    stats.claims++;
                    stats.users.add(tx.to);
                    stats.totalPaid += tx.amount;
                }
            });

            questStatsData = questStats;
            renderQuestList();
        }

        // í€˜ìŠ¤íŠ¸ ëª©ë¡ ë Œë”ë§ (ê·¸ë£¹í™”)
        function renderQuestList() {
            const filterValue = document.getElementById('questFilter')?.value || 'default';
            
            // í€˜ìŠ¤íŠ¸ì™€ ì´ë²¤íŠ¸ ë¶„ë¦¬
            const regularQuests = QUESTS.filter(q => !q.category).map(quest => ({
                quest: quest,
                stats: questStatsData[quest.id],
                status: getQuestStatus(quest)
            }));
            
            // ì´ë²¤íŠ¸ë¥¼ íšŒì°¨ë³„ë¡œ ê·¸ë£¹í™”
            const events = {
                1: QUESTS.filter(q => q.category === 'event' && q.id >= 101 && q.id < 200),
                2: QUESTS.filter(q => q.category === 'event' && q.id >= 201 && q.id < 300),
                3: QUESTS.filter(q => q.category === 'event' && q.id >= 301 && q.id < 400)
            };

            let html = '';

            // ì¼ë°˜ í€˜ìŠ¤íŠ¸ ë Œë”ë§
            html += '<h2 class="text-2xl font-bold mb-4 text-gray-800">ğŸ“Š ì¼ë°˜ í€˜ìŠ¤íŠ¸</h2>';
            
            regularQuests.forEach(({quest, stats, status}) => {
                const statusText = status === 'active' ? 'ì§„í–‰ì¤‘' : status === 'ended' ? 'ì¢…ë£Œ' : 'ì˜ˆì •';
                const statusClass = status === 'active' ? 'bg-green-500' : status === 'ended' ? 'bg-red-500' : 'bg-orange-500';
                const cardClass = status === 'active' ? 'quest-active' : status === 'ended' ? 'quest-ended' : 'quest-upcoming';
                
                const progress = stats.claims > 0 ? Math.min(100, (stats.claims / 100) * 100) : 0;

                html += `
                    <div class="quest-card ${cardClass} mb-4">
                        <div class="flex items-start justify-between mb-3">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-1">
                                    <h3 class="font-bold text-lg text-gray-800">í€˜ìŠ¤íŠ¸ ${quest.id}: ${quest.name}</h3>
                                    <span class="status-badge ${statusClass} text-white">${statusText}</span>
                                </div>
                                <p class="text-sm text-gray-600 mb-2">${quest.description}</p>
                                <p class="text-xs text-gray-500">
                                    ğŸ“… ${quest.startDate.toLocaleDateString('ko-KR')} ~ ${quest.endDate.toLocaleDateString('ko-KR')}
                                </p>
                            </div>
                            <div class="text-right">
                                <p class="text-2xl font-bold text-purple-600">${quest.reward} ${quest.token}</p>
                                <p class="text-xs text-gray-500">ë³´ìƒ</p>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4 mb-3">
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-xs text-gray-600 mb-1">í´ë ˆì„ ìˆ˜</p>
                                <p class="text-xl font-bold text-gray-800">${stats.claims.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-xs text-gray-600 mb-1">ì°¸ì—¬ ìœ ì €</p>
                                <p class="text-xl font-bold text-gray-800">${stats.users.size.toLocaleString()}</p>
                            </div>
                            <div class="bg-gray-50 p-3 rounded-lg">
                                <p class="text-xs text-gray-600 mb-1">ì´ ì§€ê¸‰ì•¡</p>
                                <p class="text-xl font-bold text-gray-800">${stats.totalPaid.toLocaleString()}</p>
                            </div>
                        </div>
                        
                        <div class="progress-bar">
                            <div class="progress-fill" style="width: ${progress}%"></div>
                        </div>
                        <p class="text-xs text-gray-500 mt-1 text-right">í™œë™ë¥ : ${progress.toFixed(1)}%</p>
                    </div>
                `;
            });

            // ì´ë²¤íŠ¸ ë¦¬ê·¸ ë Œë”ë§
            html += '<h2 class="text-2xl font-bold mb-4 mt-8 text-gray-800">ğŸ† ì´ë²¤íŠ¸ ë¦¬ê·¸</h2>';
            
            [1, 2, 3].forEach(round => {
                const eventQuests = events[round];
                if (eventQuests.length === 0) return;

                // ì´ë²¤íŠ¸ ì „ì²´ í†µê³„ ê³„ì‚°
                let totalClaims = 0;
                let totalUsers = new Set();
                let totalPaid = 0;
                
                eventQuests.forEach(q => {
                    const stats = questStatsData[q.id];
                    totalClaims += stats.claims;
                    stats.users.forEach(u => totalUsers.add(u));
                    totalPaid += stats.totalPaid;
                });

                const firstQuest = eventQuests[0];
                const status = getQuestStatus(firstQuest);
                const statusText = status === 'active' ? 'ì§„í–‰ì¤‘' : status === 'ended' ? 'ì¢…ë£Œ' : 'ì˜ˆì •';
                const statusClass = status === 'active' ? 'bg-green-500' : status === 'ended' ? 'bg-red-500' : 'bg-orange-500';
                const cardClass = status === 'active' ? 'quest-active' : status === 'ended' ? 'quest-ended' : 'quest-upcoming';

                html += `
                    <div class="quest-card ${cardClass} mb-6">
                        <div class="flex items-start justify-between mb-4">
                            <div class="flex-1">
                                <div class="flex items-center gap-2 mb-2">
                                    <h3 class="font-bold text-xl text-gray-800">ğŸ† ì´ë²¤íŠ¸ ë¦¬ê·¸ ${round}íšŒì°¨</h3>
                                    <span class="status-badge ${statusClass} text-white">${statusText}</span>
                                </div>
                                <p class="text-xs text-gray-500">
                                    ğŸ“… ${firstQuest.startDate.toLocaleDateString('ko-KR')} ~ ${firstQuest.endDate.toLocaleDateString('ko-KR')}
                                </p>
                            </div>
                        </div>

                        <div class="grid grid-cols-3 gap-4 mb-4">
                            <div class="bg-purple-50 p-3 rounded-lg border border-purple-200">
                                <p class="text-xs text-purple-600 mb-1 font-semibold">ì´ í´ë ˆì„</p>
                                <p class="text-2xl font-bold text-purple-700">${totalClaims.toLocaleString()}</p>
                            </div>
                            <div class="bg-purple-50 p-3 rounded-lg border border-purple-200">
                                <p class="text-xs text-purple-600 mb-1 font-semibold">ì°¸ì—¬ ìœ ì €</p>
                                <p class="text-2xl font-bold text-purple-700">${totalUsers.size.toLocaleString()}</p>
                            </div>
                            <div class="bg-purple-50 p-3 rounded-lg border border-purple-200">
                                <p class="text-xs text-purple-600 mb-1 font-semibold">ì´ ì§€ê¸‰ì•¡</p>
                                <p class="text-2xl font-bold text-purple-700">${totalPaid.toLocaleString()}</p>
                            </div>
                        </div>

                        <div class="bg-gray-50 p-4 rounded-lg">
                            <h4 class="font-semibold text-sm text-gray-700 mb-3">ë“±ìˆ˜ë³„ ìƒì„¸ ë‚´ì—­</h4>
                            <table class="w-full text-sm">
                                <thead>
                                    <tr class="border-b border-gray-300">
                                        <th class="text-left py-2 text-gray-600">ë“±ìˆ˜</th>
                                        <th class="text-right py-2 text-gray-600">ë³´ìƒ</th>
                                        <th class="text-right py-2 text-gray-600">í´ë ˆì„ ìˆ˜</th>
                                        <th class="text-right py-2 text-gray-600">ì§€ê¸‰ì•¡</th>
                                    </tr>
                                </thead>
                                <tbody>
                `;

                eventQuests.forEach(q => {
                    const stats = questStatsData[q.id];
                    const rank = q.description.replace('ë­í‚¹ ', '');
                    html += `
                        <tr class="border-b border-gray-200 hover:bg-white">
                            <td class="py-2 text-gray-800">${rank}</td>
                            <td class="text-right py-2 font-semibold text-purple-600">${q.reward.toLocaleString()} BORA</td>
                            <td class="text-right py-2 text-gray-700">${stats.claims.toLocaleString()}íšŒ</td>
                            <td class="text-right py-2 text-gray-700">${stats.totalPaid.toLocaleString()} BORA</td>
                        </tr>
                    `;
                });

                html += `
                                </tbody>
                            </table>
                        </div>
                    </div>
                `;
            });

            document.getElementById('questList').innerHTML = html || '<p class="text-center text-gray-500 py-8">ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤.</p>';
        }

        // ì°¨íŠ¸ ìƒì„±
        function createCharts() {
            const dailyData = {};
            allTransactions.forEach(tx => {
                const date = new Date(tx.timestamp).toLocaleDateString('ko-KR');
                dailyData[date] = (dailyData[date] || 0) + 1;
            });

            const ctx1 = document.getElementById('dailyClaimsChart').getContext('2d');
            if (dailyClaimsChart) dailyClaimsChart.destroy();
            dailyClaimsChart = new Chart(ctx1, {
                type: 'line',
                data: {
                    labels: Object.keys(dailyData).reverse().slice(0, 30),
                    datasets: [{
                        label: 'í´ë ˆì„ ìˆ˜',
                        data: Object.values(dailyData).reverse().slice(0, 30),
                        borderColor: 'rgb(102, 126, 234)',
                        backgroundColor: 'rgba(102, 126, 234, 0.1)',
                        tension: 0.4,
                        fill: true,
                        pointRadius: 4,
                        pointHoverRadius: 6
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                precision: 0
                            }
                        }
                    }
                }
            });

            const questDistribution = {};
            allTransactions.forEach(tx => {
                if (tx.quest) {
                    const key = `Q${tx.quest.id}`;
                    questDistribution[key] = (questDistribution[key] || 0) + 1;
                }
            });

            const ctx2 = document.getElementById('questDistributionChart').getContext('2d');
            if (questDistributionChart) questDistributionChart.destroy();
            questDistributionChart = new Chart(ctx2, {
                type: 'doughnut',
                data: {
                    labels: Object.keys(questDistribution),
                    datasets: [{
                        data: Object.values(questDistribution),
                        backgroundColor: [
                            'rgba(102, 126, 234, 0.8)',
                            'rgba(240, 147, 251, 0.8)',
                            'rgba(79, 172, 254, 0.8)',
                            'rgba(67, 233, 123, 0.8)',
                            'rgba(245, 87, 108, 0.8)',
                            'rgba(250, 204, 21, 0.8)',
                            'rgba(139, 92, 246, 0.8)'
                        ],
                        borderWidth: 2,
                        borderColor: '#fff'
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: true,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                padding: 15,
                                font: {
                                    size: 11
                                }
                            }
                        }
                    }
                }
            });
        }

        // íŠ¸ëœì­ì…˜ ëª©ë¡ í‘œì‹œ
        function displayTransactions() {
            const itemsPerPage = 20;
            const start = (currentPage - 1) * itemsPerPage;
            const end = start + itemsPerPage;
            const pageTransactions = allTransactions.slice(start, end);

            if (pageTransactions.length === 0) {
                document.getElementById('transactionList').innerHTML = `
                    <tr>
                        <td colspan="5" class="text-center py-8 text-gray-500">
                            íŠ¸ëœì­ì…˜ì´ ì—†ìŠµë‹ˆë‹¤.
                        </td>
                    </tr>
                `;
                return;
            }

            const html = pageTransactions.map(tx => {
                const date = new Date(tx.timestamp);
                return `
                    <tr class="border-b hover:bg-gray-50 transition-colors">
                        <td class="py-3 px-4 text-sm text-gray-600">
                            ${date.toLocaleString('ko-KR')}
                        </td>
                        <td class="py-3 px-4 text-sm">
                            <span class="font-semibold text-purple-600">Q${tx.quest?.id || '?'}</span>
                            <span class="text-gray-600 text-xs block">${tx.quest?.name || 'ë¯¸ë¶„ë¥˜'}</span>
                        </td>
                        <td class="py-3 px-4 text-sm font-mono text-gray-700">
                            ${tx.to.substr(0, 6)}...${tx.to.substr(-4)}
                        </td>
                        <td class="py-3 px-4 text-sm text-right">
                            <span class="font-bold text-green-600">${tx.amount.toFixed(2)} ${tx.token}</span>
                        </td>
                        <td class="py-3 px-4 text-sm text-center">
                            <a href="https://kaiascan.io/tx/${tx.txHash}" target="_blank" 
                               class="text-blue-600 hover:text-blue-800 hover:underline text-xs">
                                ë³´ê¸° â†’
                            </a>
                        </td>
                    </tr>
                `;
            }).join('');

            document.getElementById('transactionList').innerHTML = html;
            document.getElementById('currentPage').textContent = currentPage;
            
            document.getElementById('prevPage').disabled = currentPage === 1;
            document.getElementById('nextPage').disabled = end >= allTransactions.length;
        }

        // í˜ì´ì§€ë„¤ì´ì…˜
        document.getElementById('prevPage').addEventListener('click', () => {
            if (currentPage > 1) {
                currentPage--;
                displayTransactions();
            }
        });

        document.getElementById('nextPage').addEventListener('click', () => {
            if (currentPage * 20 < allTransactions.length) {
                currentPage++;
                displayTransactions();
            }
        });

        // ìƒˆë¡œê³ ì¹¨ í•¨ìˆ˜
        async function refreshData() {
            localStorage.removeItem(CACHE_KEY);
            currentPage = 1;
            await initializeData();
        }

        // ì´ˆê¸°í™”
        window.addEventListener('load', () => {
            initializeData();
            
            const filterSelect = document.getElementById('questFilter');
            if (filterSelect) {
                filterSelect.addEventListener('change', renderQuestList);
            }
        });
    </script>
</body>
</html>
